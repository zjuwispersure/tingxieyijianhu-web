<!--index.wxml-->
<view class="page">
  <!-- 顶部区域 -->
  <view class="header">
    <view class="child-info" wx:if="{{selectedChild}}">
      <text class="child-name">{{selectedChild.nickname}}</text>
      <text class="child-grade">{{selectedChild.grade}}年级</text>
    </view>
    
    <!-- 修改为文字按钮 -->
    <button class="config-btn" bindtap="navigateToConfig">
      听写配置
    </button>
  </view>

  <!-- 头部信息 -->
  <view class="weui-panel user-panel">
    <view class="weui-panel__bd">
      <view class="weui-media-box weui-media-box_appmsg">
        <view class="weui-media-box__hd">
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        </view>
        <view class="weui-media-box__bd">
          <view class="weui-media-box__title">{{userInfo.nickName}}</view>
          <view class="weui-media-box__desc" wx:if="{{selectedChild}}">
            当前孩子：{{selectedChild.nickname}}
            <view class="child-grade">{{selectedChild.grade}}年级{{selectedChild.semester == 1 ? '上' : '下'}}学期</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 快速开始 -->
  <view class="weui-panel quick-start-panel">
    <view class="weui-panel__bd">
      <view class="weui-media-box weui-media-box_text">
        <view class="quick-start-content">
          <image class="start-icon" src="/assets/icons/start.png" mode="aspectFit"></image>
          <button class="weui-btn weui-btn_primary" bindtap="startDictation">开始听写</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 最近记录 -->
  <view class="weui-panel">
    <view class="weui-panel__hd">最近听写</view>
    <view class="weui-panel__bd">
      <block wx:if="{{!loading && recentDictations.length > 0}}">
        <view class="weui-media-box weui-media-box_text" 
              wx:for="{{recentDictations}}" 
              wx:key="id"
              bindtap="viewDictationDetail"
              data-id="{{item.id}}">
          <view class="weui-media-box__title">{{item.date}}</view>
          <view class="weui-media-box__info">
            <view class="weui-media-box__info__meta">共{{item.totalCount}}个词语</view>
            <view class="weui-media-box__info__meta weui-media-box__info__meta_extra">
              <text class="accuracy-text {{item.accuracy >= 90 ? 'excellent' : (item.accuracy >= 60 ? 'good' : 'poor')}}">
                正确率{{item.accuracy}}%
              </text>
            </view>
          </view>
        </view>
      </block>
      <view class="weui-loadmore weui-loadmore_line" wx:elif="{{!loading}}">
        <text class="weui-loadmore__tips">还没有听写记录，快来开始第一次听写吧！</text>
      </view>
      <view class="weui-loadmore" wx:else>
        <view class="weui-loading"></view>
        <text class="weui-loadmore__tips">正在加载</text>
      </view>
    </view>
  </view>
</view>
